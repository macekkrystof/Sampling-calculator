## Iteration 1 - Scaffold Blazor WASM app + basic project structure
- What was implemented:
  - Created Blazor WebAssembly (.NET 10) project in src/SamplingCalculator
  - Created xUnit test project in tests/SamplingCalculator.Tests
  - Created solution file (SamplingCalculator.slnx)
  - Added Models: CalculatorInput, CalculatorResult, SamplingStatus enum
  - Added Services: SamplingCalculatorService with core formulas (pixel scale, FOV, sampling classification, Dawes limit, f-ratio)
  - Built Home.razor page with Inputs panel (telescope, camera, seeing) and Results panel (pixel scale, FOV, status badge, metrics)
  - Added dark-themed CSS (app.css) with responsive 2-column layout
  - Simplified MainLayout (removed sidebar/nav), removed template pages (Counter, Weather)
  - Wrote 14 unit tests covering all calculation formulas and edge cases
- Files changed:
  - SamplingCalculator.slnx (new)
  - src/SamplingCalculator/ (new project with Models/, Services/, Pages/, Components/, Layout/)
  - tests/SamplingCalculator.Tests/ (new test project)
- Learnings for future iterations:
  - .NET 10 uses .slnx format (not .sln) by default
  - Blazor WASM template includes Counter/Weather pages that should be removed
  - FOV calculation uses unbinned sensor resolution (physical pixels on sensor)
---

## Iteration 2 - Implement calculation engine with unit-tested formulas
- What was implemented:
  - Reviewed existing calculation engine (effective focal length, pixel scale, FOV, Dawes limit, f-ratio) — already complete from iteration 1
  - Added 6 new unit tests for comprehensive coverage:
    - Combined reducer + barlow effective focal length
    - Binning 3x3 and 4x4 pixel scale
    - FOV invariance under binning
    - Pixel scale with reducer
    - f-ratio with combined reducer + barlow
  - Total: 20 tests, all passing
- Files changed:
  - tests/SamplingCalculator.Tests/UnitTest1.cs (added 6 tests)
  - prd.md (marked task 2 as passes: true)
- Learnings for future iterations:
  - PRD formula `effectiveFocal = baseFocal * barlowFactor / reducerFactor` treats reducer as divisor (0.7x reducer gives LONGER focal length, which is inverted from physical reality — but matches PRD spec)
  - FOV is binning-invariant (binning cancels out in the formula) — good property to test
  - Calculation engine was already feature-complete from iteration 1; Task 2 mainly needed test coverage expansion
---

## Iteration 3 - Add sampling classification logic (under/optimal/over) based on seeing
- What was implemented:
  - Added recommendation fields to CalculatorResult: StatusMessage, RecommendedBinning, BinningRecommendation, RecommendedCorrectorFactor, CorrectorRecommendation, ExtremeWarning
  - Implemented recommendation logic in SamplingCalculatorService:
    - Status message with invariant-culture formatted seeing value
    - Binning recommendation when oversampled (suggests higher binning to approach optimal)
    - Corrector recommendation: reducer for oversampled (focal ratio approach), barlow for undersampled
    - Extreme warnings for pixelScale > 4″/px or < 0.2″/px
  - Updated Home.razor to display StatusMessage and a recommendations card (binning, corrector, warnings)
  - Removed old FormatStatusDescription method (replaced by StatusMessage from service)
  - Added 20 new unit tests: boundary conditions (exact boundaries, just above/below), status messages, binning recommendations (oversampled/optimal/undersampled/binning-4), corrector recommendations, extreme warnings, Theory for optimal range scaling with seeing
- Files changed:
  - src/SamplingCalculator/Models/CalculatorResult.cs (added recommendation properties)
  - src/SamplingCalculator/Services/SamplingCalculatorService.cs (recommendation logic + invariant culture)
  - src/SamplingCalculator/Pages/Home.razor (display recommendations)
  - tests/SamplingCalculator.Tests/UnitTest1.cs (20 new tests, total 40)
  - prd.md (marked task 3 as passes: true)
- Learnings for future iterations:
  - Must use CultureInfo.InvariantCulture for string formatting — system locale uses comma decimal separator
  - PRD formula `effectiveFocal = baseFocal * barlow / reducer` is inverted from physical reality; a 0.7× reducer INCREASES effective focal. Reducer recommendations for oversampled setups use focal ratio approach instead.
  - Boundary tests: at exact thresholds (seeing/2, seeing/3), the status should be Optimal (not strict inequality)
---

## Iteration 4 - Build input form components with validation and sensible defaults
- What was implemented:
  - Created InputValidationService (static class) with validation methods for all input fields: focal length, aperture, reducer, barlow, pixel size, sensor dimensions, seeing
  - Created reusable NumericInput.razor component with: label, unit display, optional marker, tooltip icon, validation error display, aria attributes for accessibility
  - Refactored Home.razor to use NumericInput components instead of raw input elements
  - Added validation-aware results: results panel hides and shows warning when inputs are invalid
  - Added active state highlighting for seeing preset buttons
  - Added CSS for validation error states (red border, error messages), tooltip icons, active preset button, recommendations card
  - Fixed InvariantCulture rendering for numeric input values (needed for locales with comma decimal separator)
  - Set up Playwright .NET test project (NUnit + Microsoft.Playwright.NUnit)
  - Wrote 43 unit tests for InputValidationService (boundary conditions for all validators)
  - Wrote 10 Playwright UI tests: defaults, presets, validation errors, binning, tooltips
- Files changed:
  - src/SamplingCalculator/Services/InputValidationService.cs (new)
  - src/SamplingCalculator/Components/NumericInput.razor (new)
  - src/SamplingCalculator/Pages/Home.razor (refactored to use NumericInput)
  - src/SamplingCalculator/_Imports.razor (added Components namespace)
  - src/SamplingCalculator/wwwroot/css/app.css (validation, tooltip, active preset styles)
  - tests/SamplingCalculator.Tests/UnitTest1.cs (43 new validation tests, total 83)
  - tests/SamplingCalculator.Playwright/ (new project, 10 UI tests)
  - SamplingCalculator.slnx (added Playwright project)
  - prd.md (marked task 4 as passes: true)
- Learnings for future iterations:
  - Blazor WASM renders numeric input `value` attribute using system culture; must use `.ToString(CultureInfo.InvariantCulture)` to ensure period decimal separator in HTML
  - `using` directives in Razor components must be at the top level (`@using`), not inside `@code {}` blocks
  - Playwright tests for Blazor WASM need `WaitUntilState.NetworkIdle` + explicit wait for rendered element due to .NET runtime download time
  - Result display values (ToString("F2")) still use system locale (comma decimals) — acceptable for user display but worth noting
  - Playwright NUnit base class `PageTest` handles browser/page lifecycle automatically
---
