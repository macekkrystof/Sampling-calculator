@page "/"
@using SamplingCalculator.Models
@using SamplingCalculator.Services
@using SamplingCalculator.Components

<PageTitle>Sampling Calculator</PageTitle>

<div class="calculator-container">
    <header class="calculator-header">
        <h1>Sampling Calculator</h1>
        <p class="subtitle">Camera &times; Telescope sampling evaluator for astrophotography</p>
    </header>

    <div class="compare-toggle-container">
        <label class="compare-toggle">
            <input type="checkbox" @bind="CompareMode" @bind:after="OnCompareModeChanged" />
            <span class="toggle-label">Compare mode</span>
        </label>
        @if (CompareMode)
        {
            <button class="copy-btn" @onclick="CopyAToB" aria-label="Copy Setup A values to Setup B">
                Copy A &rarr; B
            </button>
        }
    </div>

    @if (CompareMode)
    {
        <div class="compare-layout">
            <div class="setup-column setup-a">
                <InputPanel SetupLabel="Setup A" IdPrefix="a" Input="InputA" OnInputChanged="StateHasChanged" />
                <ResultsPanel ResultsLabel="Results A" IdPrefix="a" Input="InputA" Compact="true" />
            </div>
            <div class="setup-column setup-b">
                <InputPanel SetupLabel="Setup B" IdPrefix="b" Input="InputB" OnInputChanged="StateHasChanged" />
                <ResultsPanel ResultsLabel="Results B" IdPrefix="b" Input="InputB" Compact="true" />
            </div>
        </div>
    }
    else
    {
        <div class="calculator-layout">
            <InputPanel SetupLabel="Setup" IdPrefix="single" Input="InputA" OnInputChanged="StateHasChanged" />
            <ResultsPanel ResultsLabel="Results" IdPrefix="single" Input="InputA" />
        </div>
    }
</div>

@code {
    private CalculatorInput InputA { get; set; } = new();
    private CalculatorInput InputB { get; set; } = new();
    private bool CompareMode { get; set; } = false;

    private void OnCompareModeChanged()
    {
        if (CompareMode)
        {
            // When entering compare mode, copy A to B as initial state
            InputB.CopyFrom(InputA);
        }
    }

    private void CopyAToB()
    {
        InputB.CopyFrom(InputA);
        StateHasChanged();
    }
}
