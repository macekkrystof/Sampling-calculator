@namespace SamplingCalculator.Components
@using SamplingCalculator.Models
@using SamplingCalculator.Services

<section class="inputs-panel" aria-label="@(SetupLabel) configuration">
    <h2>@SetupLabel</h2>

    <div class="input-group">
        <h3>Telescope / Optics</h3>
        <NumericInput Id="@($"{IdPrefix}-focalLength")"
                      Label="Focal length"
                      Unit="mm"
                      Tooltip="Base focal length of your telescope or lens"
                      Value="@Input.BaseFocalLength"
                      ValueChanged="@(v => { Input.BaseFocalLength = v; OnInputChanged.InvokeAsync(); })"
                      Min="1" Step="1"
                      Validate="InputValidationService.ValidateFocalLength" />

        <NumericInput Id="@($"{IdPrefix}-aperture")"
                      Label="Aperture diameter"
                      Unit="mm"
                      Tooltip="Diameter of the primary mirror or lens. Used for Dawes limit and f-ratio."
                      IsOptional="true"
                      Value="@(Input.ApertureDiameter ?? 0)"
                      ValueChanged="@(v => { Input.ApertureDiameter = v > 0 ? v : null; OnInputChanged.InvokeAsync(); })"
                      Min="1" Step="1"
                      Validate="@(v => InputValidationService.ValidateAperture(v > 0 ? v : null))" />

        <NumericInput Id="@($"{IdPrefix}-reducer")"
                      Label="Reducer factor"
                      Unit="×"
                      Tooltip="Focal reducer factor (e.g. 0.7×). Leave at 1.0 if not using a reducer."
                      Value="@Input.ReducerFactor"
                      ValueChanged="@(v => { Input.ReducerFactor = v; OnInputChanged.InvokeAsync(); })"
                      Min="0.1" Max="1.0" Step="0.05"
                      Validate="InputValidationService.ValidateReducerFactor" />

        <NumericInput Id="@($"{IdPrefix}-barlow")"
                      Label="Barlow factor"
                      Unit="×"
                      Tooltip="Barlow lens magnification (e.g. 2×). Leave at 1.0 if not using a barlow."
                      Value="@Input.BarlowFactor"
                      ValueChanged="@(v => { Input.BarlowFactor = v; OnInputChanged.InvokeAsync(); })"
                      Min="1.0" Max="5.0" Step="0.1"
                      Validate="InputValidationService.ValidateBarlowFactor" />
    </div>

    <div class="input-group">
        <h3>Camera / Sensor</h3>
        <NumericInput Id="@($"{IdPrefix}-pixelSize")"
                      Label="Pixel size"
                      Unit="µm"
                      Tooltip="Physical size of a single sensor pixel in micrometers"
                      Value="@Input.PixelSize"
                      ValueChanged="@(v => { Input.PixelSize = v; OnInputChanged.InvokeAsync(); })"
                      Min="0.1" Step="0.01"
                      Validate="InputValidationService.ValidatePixelSize" />

        <NumericInput Id="@($"{IdPrefix}-sensorWidth")"
                      Label="Sensor width"
                      Unit="px"
                      Tooltip="Horizontal resolution of the sensor in pixels"
                      Value="@Input.SensorWidthPx"
                      ValueChanged="@(v => { Input.SensorWidthPx = (int)v; OnInputChanged.InvokeAsync(); })"
                      Min="1" Step="1"
                      Validate="@(v => InputValidationService.ValidateSensorDimension((int)v))" />

        <NumericInput Id="@($"{IdPrefix}-sensorHeight")"
                      Label="Sensor height"
                      Unit="px"
                      Tooltip="Vertical resolution of the sensor in pixels"
                      Value="@Input.SensorHeightPx"
                      ValueChanged="@(v => { Input.SensorHeightPx = (int)v; OnInputChanged.InvokeAsync(); })"
                      Min="1" Step="1"
                      Validate="@(v => InputValidationService.ValidateSensorDimension((int)v))" />

        <div class="field">
            <label for="@($"{IdPrefix}-binning")">
                Binning
                <span class="tooltip-icon" title="Combines adjacent pixels. Higher binning increases pixel scale and sensitivity but reduces resolution.">?</span>
            </label>
            <select id="@($"{IdPrefix}-binning")" @bind="Input.Binning" @bind:event="oninput" @bind:after="@(() => OnInputChanged.InvokeAsync())">
                <option value="1">1&times;1</option>
                <option value="2">2&times;2</option>
                <option value="3">3&times;3</option>
                <option value="4">4&times;4</option>
            </select>
        </div>
    </div>

    <div class="input-group">
        <h3>Seeing</h3>
        <NumericInput Id="@($"{IdPrefix}-seeing")"
                      Label="Seeing"
                      Unit="arcsec"
                      Tooltip="Typical atmospheric seeing at your location (FWHM of stars)"
                      Value="@Input.Seeing"
                      ValueChanged="@(v => { Input.Seeing = v; OnInputChanged.InvokeAsync(); })"
                      Min="0.1" Step="0.1"
                      Validate="InputValidationService.ValidateSeeing" />

        <div class="seeing-presets">
            <button class="preset-btn @(Input.Seeing == 1.5 ? "preset-active" : "")" @onclick='() => { Input.Seeing = 1.5; OnInputChanged.InvokeAsync(); }'>Excellent (1.5″)</button>
            <button class="preset-btn @(Input.Seeing == 2.0 ? "preset-active" : "")" @onclick='() => { Input.Seeing = 2.0; OnInputChanged.InvokeAsync(); }'>Average (2.0″)</button>
            <button class="preset-btn @(Input.Seeing == 3.0 ? "preset-active" : "")" @onclick='() => { Input.Seeing = 3.0; OnInputChanged.InvokeAsync(); }'>Poor (3.0″)</button>
        </div>
    </div>
</section>

@code {
    [Parameter] public string SetupLabel { get; set; } = "Setup";
    [Parameter] public string IdPrefix { get; set; } = "input";
    [Parameter] public CalculatorInput Input { get; set; } = new();
    [Parameter] public EventCallback OnInputChanged { get; set; }
}
